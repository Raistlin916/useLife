import t,{useState as r,useReducer as e,useCallback as n,useEffect as o,useContext as a}from"react";import u from"axios";function c(t,r,e,n,o,a,u){try{var c=t[a](u),i=c.value}catch(t){return void e(t)}c.done?r(i):Promise.resolve(i).then(n,o)}function i(t){return function(){var r=this,e=arguments;return new Promise((function(n,o){var a=t.apply(r,e);function u(t){c(a,n,o,u,i,"next",t)}function i(t){c(a,n,o,u,i,"throw",t)}u(void 0)}))}}function s(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function f(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function p(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?f(Object(e),!0).forEach((function(r){s(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function l(t,r){if(null==t)return{};var e,n,o=function(t,r){if(null==t)return{};var e,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||(o[e]=t[e]);return o}(t,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)e=a[n],r.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(t,e)&&(o[e]=t[e])}return o}function y(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],n=!0,o=!1,a=void 0;try{for(var u,c=t[Symbol.iterator]();!(n=(u=c.next()).done)&&(e.push(u.value),!r||e.length!==r);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return e}(t,r)||function(t,r){if(!t)return;if("string"==typeof t)return v(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return v(t,r)}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var g,m=function(t){var e=y(r(t),2),n=e[0],o=e[1];return[n,function(){return o(!n)}]};!function(t){t[t.PENDING=0]="PENDING",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(g||(g={}));var d=function(t){return{data:t,sync:function(){return Promise.resolve()},loading:!1,loaded:!1,id:void 0,isEmpty:function(){return!0}}},b=function(t,r){switch(r.type){case"set":return p(p({},t),r.payload);case"reset":return p(p({},t),{},{status:g.PENDING});default:throw new Error}},h=function(t,r,a,u){var c=y(e(b,{result:a,status:g.PENDING}),2),s=c[0],f=c[1],l="".concat(t.id,":").concat(void 0===r?void 0:JSON.stringify(r)),v=n(function(){var e=i(regeneratorRuntime.mark((function e(n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f({type:"set",payload:{status:g.LOADING}}),e.next=4,t(p(p({},r),n));case 4:return o=e.sent,f({type:"set",payload:{result:o,status:g.LOADED}}),e.abrupt("return",o);case 9:throw e.prev=9,e.t0=e.catch(0),f({type:"reset"}),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),[l]);return o((function(){!1!==u&&void 0!==r&&v()}),[l,u]),{data:s.result,sync:v,loading:s.status===g.LOADING,loaded:s.status===g.LOADED,id:l,isEmpty:function(){return!l}}},O=u.create(),w={autoSync:void 0,transformRequest:function(t){return t},transformResponse:function(t){return t}},x=function(t,r,e,n,o){var a="request-".concat(t,"-").concat(r,"-").concat(JSON.stringify(e)),u=p(p({},w),o),c=function(){var e=i(regeneratorRuntime.mark((function e(o){var a,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}return e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:if(a=u.transformRequest(o),"get"!==t&&"delete"!==t){e.next=11;break}return e.next=8,O[t](r,p({params:a},u.config));case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,O[t](r,a,u.config);case 13:e.t0=e.sent;case 14:return c=e.t0,e.abrupt("return",u.transformResponse(c));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.id=r,p(p({},h(c,e,n,u.autoSync)),{},{id:a})},N=function(t,r,e,n){return x("get",t,r,e,n)},S=function(t,r,e,n){return x("post",t,r,e,n)},j=function(t){O=t},D=p(p({},w),{},{method:"post",pageSize:10,pageNumberName:"pageNo",totalName:"count"}),P=function(t){D=p(p({},D),t)},E=function(t,e,n,a){var u=p(p({},D),a),c=y(r(1),2),i=c[0],f=c[1],v=y(r({}),2),g=v[0],m=v[1],d=u.totalName,b=u.pageSize,h=u.pageNumberName,O=x(u.method,t,p(p({},e),{},s({pageSize:b},h,i),g),n||s({list:[]},d,0),p({autoSync:!1},u)),w=O.data,N=O.sync,S=l(O,["data","sync"]),j=function(t){var r=t.value,e=t.onChange,n=t.total;return{onChange:e,current:r,pageSize:t.options.pageSize,total:n,showQuickJumper:!0,showTotal:function(t){return"共".concat(t,"条")}}}({value:i,onChange:function(t){f(t)},options:u,total:w[d]}),P=JSON.stringify(e);return o((function(){f(1)}),[P]),p(p({data:w,sync:N},S),{},{pagination:j,setFilters:function(t){f(1),m(t)}})},R={},k={get:function(t){return R[t]||(R[t]=new Map),R[t]}},A=t.createContext(k),I=function(e){var n=e.children,o=y(r(k),1)[0];return t.createElement(A.Provider,{value:o},n)},G=function(t,r,e,n){var o=a(A).get(t),u=[],c=e.map((function(t){return o.has(t)?o.get(t):(u.push(t),n)}));return p(p({},h(function(){var t=i(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.length){t.next=2;break}return t.abrupt("return",[]);case 2:return t.next=4,r(e);case 4:return(n=t.sent).forEach((function(t,r){return o.set(e[r],t)})),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}(),u,u.map((function(){return n})))),{},{data:c})},L=function(t,r,e){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map,o=a(A),u=h(function(){var n=i(regeneratorRuntime.mark((function n(a){var u,c,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u=JSON.stringify(e),c=o.get("".concat(t,"#").concat(u)),n.next=4,r(a);case 4:return i=n.sent,Object.keys(i).forEach((function(t){return c.set(t,i[t])})),n.abrupt("return",c);case 7:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),e,n);return u},J=function(t,r,e,n){var o=a(A);return h(function(){var n=i(regeneratorRuntime.mark((function n(a){var u,c,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u="".concat(t,"#").concat(JSON.stringify(e)),c=o.get("const"),void 0!==(i=c.get(u))){n.next=7;break}return n.next=6,r(a);case 6:i=n.sent;case 7:return c.set(u,i),n.abrupt("return",i);case 9:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}(),e,n)};export{I as ResourcePool,P as configUsePaginationRequest,j as configUseRequest,w as defaultOptions,d as useEmptyResource,N as useGet,E as usePaginationRequest,S as usePost,E as useRequest,h as useResource,J as useResourceConst,G as useResourcePool,L as useResourcePoolMap,m as useToggle};
